<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MedLA</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
<nav>
    <a href="#about">About</a>
    <a href="#results">Results</a>
    <a href="#html-gallery">HTML Gallery</a>
</nav>

<main>
    <section id="about">
        <h1>MedLA</h1>
        <p>Medical Landmark Annotation</p>
    </section>

    <section id="results">
        <h2>Results</h2>
        <p>...</p>
    </section>

    <!-- HTML Samples Carousel -->
    <section id="html-gallery" class="html-gallery">
        <h2>HTML Gallery</h2>
        <p class="html-gallery__hint">Browse interactive HTML samples.</p>

        <div class="html-carousel" data-samples-json="html/html/samples.json">
            <div class="html-carousel__controls">
                <button type="button" class="html-carousel__btn" data-action="prev" aria-label="Previous sample">‹</button>
                <div class="html-carousel__meta">
                    <span class="html-carousel__title" data-role="title">Loading…</span>
                    <span class="html-carousel__counter" data-role="counter"></span>
                </div>
                <button type="button" class="html-carousel__btn" data-action="next" aria-label="Next sample">›</button>
            </div>

            <div class="html-carousel__frameWrap">
                <iframe class="html-carousel__frame" data-role="frame" title="HTML sample" loading="lazy" referrerpolicy="no-referrer"></iframe>
            </div>
        </div>

        <noscript>
            <p>This section requires JavaScript to load the sample list.</p>
        </noscript>
    </section>
</main>

<script>
(function () {
  function qs(root, sel) { return root.querySelector(sel); }

  async function initHtmlCarousel(carouselEl) {
    const jsonPath = carouselEl.getAttribute('data-samples-json');
    const titleEl = qs(carouselEl, '[data-role="title"]');
    const counterEl = qs(carouselEl, '[data-role="counter"]');
    const frameEl = qs(carouselEl, '[data-role="frame"]');
    const prevBtn = qs(carouselEl, '[data-action="prev"]');
    const nextBtn = qs(carouselEl, '[data-action="next"]');

    let samples = [];
    let idx = 0;

    function normalizeItem(item) {
      if (typeof item === 'string') return { title: item, src: item };
      if (item && typeof item === 'object') {
        return {
          title: item.title || item.name || item.src || 'Untitled',
          src: item.src || item.path || item.url || ''
        };
      }
      return { title: 'Untitled', src: '' };
    }

    function setDisabled(btn, disabled) {
      btn.disabled = !!disabled;
      btn.setAttribute('aria-disabled', disabled ? 'true' : 'false');
    }

    function render() {
      if (!samples.length) {
        titleEl.textContent = 'No samples found.';
        counterEl.textContent = '';
        frameEl.removeAttribute('src');
        setDisabled(prevBtn, true);
        setDisabled(nextBtn, true);
        return;
      }

      idx = (idx + samples.length) % samples.length;
      const s = samples[idx];
      titleEl.textContent = s.title || 'Untitled';
      counterEl.textContent = (idx + 1) + ' / ' + samples.length;
      if (s.src) frameEl.src = s.src;
      setDisabled(prevBtn, samples.length <= 1);
      setDisabled(nextBtn, samples.length <= 1);
    }

    function onPrev() { idx -= 1; render(); }
    function onNext() { idx += 1; render(); }

    prevBtn.addEventListener('click', onPrev);
    nextBtn.addEventListener('click', onNext);

    // keyboard support when focused in the carousel region
    carouselEl.addEventListener('keydown', function (e) {
      if (e.key === 'ArrowLeft') { e.preventDefault(); onPrev(); }
      if (e.key === 'ArrowRight') { e.preventDefault(); onNext(); }
    });

    try {
      const res = await fetch(jsonPath, { cache: 'no-cache' });
      if (!res.ok) throw new Error('Failed to load ' + jsonPath);
      const data = await res.json();
      const list = Array.isArray(data) ? data : (Array.isArray(data.samples) ? data.samples : []);
      samples = list.map(normalizeItem).filter(x => x.src);
      render();
    } catch (err) {
      titleEl.textContent = 'Failed to load samples.';
      counterEl.textContent = '';
      console.error(err);
    }
  }

  document.addEventListener('DOMContentLoaded', function () {
    document.querySelectorAll('.html-carousel[data-samples-json]').forEach(initHtmlCarousel);
  });
})();
</script>
</body>
</html>
